"use strict";const w=require("os"),R=require("superagent"),b=require("util"),st=require("uuid"),x=require("crypto"),rt="@easypost/api",at="EasyPost Node Client Library",ct="7.5.5",nt="Easypost Engineering <oss@easypost.com>",it="https://easypost.com",ot={easypost:"./repl.js"},ut={type:"git",url:"git://github.com/easypost/easypost-node.git"},lt="index.js",dt="types/index.d.ts",_t="MIT",pt={node:">= 12.0"},ht={build:"vite build",clean:"rm -rf ./dist ./nyc_output ./node_modules/.cache ./coverage",coverage:"cross-env NODE_ENV=test vitest run --coverage",docs:"./node_modules/.bin/jsdoc src/models src/services src/errors src/utils -d docs",format:"prettier --write .",formatCheck:"prettier --check .",lint:"eslint --ext .js,.ts .",lintFix:"eslint --ext .js,.ts --fix .",prepublishOnly:"npm run clean && npm run build && npm run test && npm run lint && npm run formatCheck",repl:"./repl.js --local ./dist/easypost.js",scan:"npx audit-ci -m --config ./audit-ci.jsonc",test:"cross-env NODE_ENV=test vitest run","test:node-compatibility":"cross-env NODE_ENV=test node ./test/node_compatibility",watch:"vite build --watch"},mt={"core-js":"~3.30.2","nodent-runtime":"~3.2.1","regenerator-runtime":"~0.13.11","source-map-support":"~0.5.21",superagent:"~8.0.9",uuid:"^9.0.0",yargs:"~17.7.2","yargs-parser":"~21.1.1"},yt={"@pollyjs/adapter-node-http":"^6.0.5","@pollyjs/core":"^6.0.5","@pollyjs/persister-fs":"^6.0.5","@typescript-eslint/eslint-plugin":"^5.59.5","@typescript-eslint/parser":"^5.59.5","@vitest/coverage-istanbul":"^2.1.8","audit-ci":"^6.6.1",chai:"4.3.10","chai-as-promised":"^7.1.1","cross-env":"^7.0.3",dotenv:"^16.4.5",eslint:"^8.40.0","eslint-config-prettier":"^8.8.0","eslint-import-resolver-webpack":"^0.13.2","eslint-plugin-babel":"^5.3.1","eslint-plugin-import":"^2.27.5","eslint-plugin-jest":"^27.2.1","eslint-plugin-jsx-a11y":"^6.7.1","eslint-plugin-react":"^7.32.1","eslint-plugin-vitest-globals":"^1.5.0",jsdoc:"^4.0.2",prettier:"^2.8.8",typescript:"^4.9.5 || ~5.0.0",vite:"^6.0.11","vite-plugin-externals":"^0.6.2",vitest:"^2.1.8",vows:"^0.8.3"},vt={name:rt,description:at,version:ct,author:nt,homepage:it,bin:ot,repository:ut,main:lt,types:dt,license:_t,engines:pt,scripts:ht,dependencies:mt,devDependencies:yt};class f extends Error{constructor({message:n}={}){super(n)}}class O extends f{}class k extends f{}class S extends f{}class I{getLowestSmartRate(n,t,e){const s=new Set(["percentile_50","percentile_75","percentile_85","percentile_90","percentile_95","percentile_97","percentile_99"]);let a=null;const c=e.toLowerCase();if(!s.has(c))throw new k({message:`Invalid deliveryAccuracy value, must be one of: ${new Array(...s).join(", ")}`});for(let i=0;i<n.length;i+=1){const o=n[i];o.time_in_transit[c]>parseInt(t,10)||(a===null||parseFloat(o.rate)<parseFloat(a.rate))&&(a=o)}if(a===null)throw new O({message:b.format(h.NO_OBJECT_FOUND,"rates")});return a}getLowestRate(n,t=null,e=null){if(t){const s=t.map(a=>a.toLowerCase());n=n.filter(a=>s.includes(a.carrier.toLowerCase()))}if(e){const s=e.map(a=>a.toLowerCase());n=n.filter(a=>s.includes(a.service.toLowerCase()))}if(n.length===0)throw new O({message:b.format(h.NO_OBJECT_FOUND,"rates")});return n.reduce((s,a)=>parseFloat(a.rate)<parseFloat(s.rate)?a:s,n[0])}validateWebhook(n,t,e){var c,i;let s={};const a=(i=(c=t["X-Hmac-Signature"])!=null?c:t["x-hmac-signature"])!=null?i:null;if(a!=null){const o=e.normalize("NFKD"),p=Buffer.from(o,"utf8"),_=Buffer.from(n).toString("utf8").replace(/("weight":\s*)(\d+)(\s*)(?=,|\})/g,"$1$2.0"),v=`hmac-sha256-hex=${x.createHmac("sha256",p).update(_,"utf-8").digest("hex")}`;try{if(x.timingSafeEqual(Buffer.from(a,"utf8"),Buffer.from(v,"utf8")))s=JSON.parse(_);else throw new S({message:h.WEBHOOK_DOES_NOT_MATCH})}catch{throw new S({message:h.WEBHOOK_DOES_NOT_MATCH})}}else throw new S({message:h.INVALID_WEBHOOK_SIGNATURE});return s}}class h{static get CARRIER_ACCOUNTS_WITH_CUSTOM_CREATE_WORKFLOWS(){return["FedexAccount","FedexSmartpostAccount"]}static get UPS_OAUTH_CARRIER_TYPES(){return["UpsAccount","UpsMailInnovationsAccount","UpsSurepostAccount"]}static EXTERNAL_API_CALL_FAILED="Communication with %s failed, please try again later";static INVALID_API_KEY_TYPE="Invalid API key type.";static INVALID_PARAMETER="Invalid parameter: %s.";static INVALID_PAYMENT="The chosen payment method is not a credit card. Please try again.";static INVALID_WEBHOOK_SIGNATURE="Webhook does not contain a valid HMAC signature.";static MISSING_REQUIRED_PARAMETER="Missing required parameter: %s.";static NO_OBJECT_FOUND="No %s found.";static NO_PAYMENT_METHODS="No payment methods are set up. Please add a payment method and try again.";static API_DID_NOT_RETURN_ERROR_DETAILS="API did not return error details.";static WEBHOOK_DOES_NOT_MATCH="Webhook received did not originate from EasyPost or had a webhook secret mismatch.";static END_OF_PAGINATION="There are no more pages to retrieve.";static ERROR_DESERIALIZATION="Error deserializing JSON response";static Utils=new I}class m extends f{constructor({message:n,code:t,statusCode:e,errors:s}={}){super({message:n}),this.code=t,this.errors=s,this.message=n,this.statusCode=e}}class ft extends m{}class gt extends m{}class bt extends m{}class Pt extends m{}class Et extends m{}class wt extends m{}class St extends m{}class Tt extends m{}class Ot extends m{}class xt extends m{}class jt extends m{}class At extends m{}class Rt extends m{}class kt extends m{}class It{static traverseJsonElement(n,t){if(n instanceof Object)for(const e of Object.values(n))this.traverseJsonElement(e,t);else if(n instanceof Array)for(const e of n)this.traverseJsonElement(e,t);else t.push(n.toString())}static handleApiError(n){const{statusCode:t}=n,{code:e,message:s,errors:a}=n.body.error,c={message:s,code:e,statusCode:t,errors:a};try{const i=[];this.traverseJsonElement(c.message,i),c.message=i.join(", ")}catch{const o={message:h.ERROR_DESERIALIZATION,code:"ERROR_DESERIALIZATION_ERROR"};return new f(o)}if(t>=300&&t<400)return new xt(c);switch(t){case 400:return new ft(c);case 401:return new Rt(c);case 402:return new Tt(c);case 403:return new gt(c);case 404:return new St(c);case 405:return new wt(c);case 408:return new At(c);case 422:return new Et(c);case 429:return new Ot(c);case 500:return new Pt(c);case 503:return new jt(c);case 504:return new bt(c);default:return new kt(c)}}}class Nt extends f{}class u{static id;static object;static mode;static created_at;static updated_at;static _params}class N extends u{static street1;static street2;static city;static state;static zip;static country;static residential;static carrier_facility;static name;static company;static phone;static email;static federal_tax_id;static state_tax_id;static verifications}class $ extends u{static active;static key}class D extends u{static label_url;static num_shipments;static pickup;static reference;static scan_form;static shipments;static state;static status}class U extends u{static ad_href;static ad;static background_color;static color;static logo_href;static logo;static name;static theme;static user_id}class H extends u{static billing_type;static clone;static credentials;static description;static fields;static readable;static reference;static test_credentials}class $t extends u{static fields;static type}class Dt extends u{static id;static object;static mode;static attachments;static contact_email;static created_at;static description;static history;static insurance_amount;static insurance_id;static payment_method;static requested_amount;static shipment_id;static status;static status_detail;static status_timestamp;static tracking_code;static type;static updated_at}class M extends u{static content_explanation;static contents_type;static customs_certify;static customs_items;static customs_signer;static declaration;static eel_pfc;static non_delivery_option;static restriction_comments;static restriction_type}class L extends u{static code;static currency;static description;static hs_tariff_number;static origin_country;static quantity;static value;static weight}class q extends u{static street1;static street2;static city;static state;static zip;static country;static name;static company;static phone;static email}class B extends u{static completed_urls;static description;static pending_urls;static previous_attributes;static result;static status}class Ut extends u{static form_type;static form_url;static submitted_electronically}class F extends u{static amount;static fee;static from_address;static messages;static provider_id;static provider;static reference;static shipment_id;static status;static to_address;static tracking_code;static tracker}class C extends u{static buyer_address;static from_address;static is_return;static messages;static rates;static reference;static return_address;static shipments;static to_address;lowestRate(n,t){const e=this.rates||[];return h.Utils.getLowestRate(e,n,t)}}class V extends u{static height;static length;static predefined_package;static weight;static width}class K extends u{static response_body}class W extends u{static address;static carrier_accounts;static confirmation;static instructions;static is_account_address;static max_datetime;static messages;static min_datetime;static pickup_rates;static reference;static shipment;static status;lowestRate(n,t){const e=this.pickup_rates||[];return h.Utils.getLowestRate(e,n,t)}}class z extends u{static carrier;static currency;static pickup_id;static rate;static service}class G extends u{static label_date;static label_epl2_url;static label_file_type;static label_pdf_url;static label_resolution;static label_size;static label_type;static label_url;static label_zpl_url}class J extends u{static billing_type;static carrier_account_id;static carrier;static currency;static delivery_date_guaranteed;static delivery_date;static delivery_days;static est_delivery_days;static list_currency;static list_rate;static rate;static retail_currency;static retail_rate;static service;static shipment_id}class Y extends u{static carrier;static confirmation_number;static shipment_id;static status;static tracking_code}class g extends u{static end_date;static include_children;static send_email;static start_date;static status;static url_expires_at;static url}class X extends u{static address;static batch_id;static form_file_type;static form_url;static message;static status;static tracking_codes}class Q extends u{static batch_id;static batch_message;static batch_status;static buyer_address;static customs_info;static fees;static forms;static from_address;static insurance;static is_return;static messages;static options;static parcel;static postage_label;static rates;static reference;static refund_status;static return_address;static scan_form;static selected_rate;static status;static to_address;static tracker;static tracking_code;static usps_zone;lowestRate(n,t){const e=this.rates||[];return h.Utils.getLowestRate(e,n,t)}}class Z extends u{static carrier_details;static carrier;static est_delivery_date;static fees;static public_url;static shipment_id;static signed_by;static status;static status_detail;static tracking_code;static tracking_details;static weight}class tt extends u{static api_keys;static balance;static cc_fee_rate;static children;static email;static insurance_fee_minimum;static insurance_fee_rate;static name;static parent_id;static phone_number;static price_per_shipment;static recharge_amount;static secondary_recharge_amount}class et extends u{static disabled_at;static url}class P extends f{constructor(){super({message:h.END_OF_PAGINATION})}}const j={adr:N,ak:$,batch:D,brd:U,ca:H,cfrep:g,clm:Dt,cstinfo:M,cstitem:L,es:q,evt:B,hook:et,ins:F,order:C,payload:K,pickup:W,pickuprate:z,pl:G,plrep:g,prcl:V,rate:J,refrep:g,rfnd:Y,sf:X,shp:Q,shpinvrep:g,shprep:g,trk:Z,trkrep:g,user:tt},A={Address:N,ApiKey:$,Batch:D,Brand:U,CarrierAccount:H,CarrierType:$t,CustomsInfo:M,CustomsItem:L,EasyPostObject:u,EndShipper:q,Event:B,Form:Ut,Insurance:F,Order:C,Parcel:V,Payload:K,Pickup:W,PickupRate:z,PostageLabel:G,Rate:J,Refund:Y,Report:g,ScanForm:X,Shipment:Q,Tracker:Z,User:tt,Webhook:et},l=r=>class{static _convertToEasyPostObject(t,e){if(Array.isArray(t))return t.map(s=>typeof s=="object"?this._convertToEasyPostObject(s,e):s);if(typeof t=="object"&&t!==null){let s;if(A[t.object]!==void 0)s=new A[t.object];else if(t.id!==void 0&&j[t.id.substr(0,t.id.indexOf("_"))]!==void 0){const a=t.id.substr(0,t.id.indexOf("_"));s=new j[a]}else s=new u;return Object.keys(t).forEach(a=>{s[a]=this._convertToEasyPostObject(t[a],e)}),s._params=e,s}return t}static async _create(t,e){try{const s=await r._post(t,e);return this._convertToEasyPostObject(s.body,e)}catch(s){return Promise.reject(s)}}static async _all(t,e={}){try{const s=await r._get(t,e);return this._convertToEasyPostObject(s.body,e)}catch(s){return Promise.reject(s)}}static async _retrieve(t){try{const e=await r._get(t);return this._convertToEasyPostObject(e.body)}catch(e){return Promise.reject(e)}}static async _getNextPage(t,e,s,a=null,c={}){var y,v,E;const i=s[e];if(i==null||i.length==0||!s.has_more)throw new P;const o=(v=(y=s._params)!=null?y:i[0]._params)!=null?v:{},p={...o,page_size:(E=o.page_size)!=null?E:a,before_id:i[i.length-1].id,...c},_=await this._all(t,p);if(_==null||_[e].length==0)throw new P;return _}},Ht=r=>class extends l(r){static async create(t){const e="addresses",s={address:t};if(t.verify){const a=t;s.verify=t.verify,delete a.verify}if(t.verify_strict){const a=t;s.verify_strict=t.verify_strict,delete a.verify_strict}return this._create(e,s)}static async createAndVerify(t){const e="addresses/create_and_verify",s={address:t};try{const a=await r._post(e,s);return this._convertToEasyPostObject(a.body.address,s)}catch(a){return Promise.reject(a)}}static async all(t={}){return this._all("addresses",t)}static async getNextPage(t,e=null){return this._getNextPage("addresses","addresses",t,e)}static async retrieve(t){const e=`addresses/${t}`;return this._retrieve(e)}static async verifyAddress(t){try{const e=`addresses/${t}/verify`,s=await r._get(e);return this._convertToEasyPostObject(s.body.address)}catch(e){return Promise.reject(e)}}},Mt=r=>class extends l(r){static async all(t={}){return this._all("api_keys",t)}static async retrieveApiKeysForUser(t){const e="api_keys";try{const s=await r._get(e),a=this._convertToEasyPostObject(s.body);if(a.id==t)return a.keys;a.children.forEach(c=>{if(c.id==t)return c.keys})}catch(s){return Promise.reject(s)}throw new O({message:b.format(h.NO_OBJECT_FOUND,"child")})}},Lt="pdf",qt=r=>class extends l(r){static async create(t){const e="batches",s={batch:t};return this._create(e,s)}static async addShipments(t,e){const s=`batches/${t}/add_shipments`,a={shipments:e.map(c=>({id:c}))};try{const c=await r._post(s,a);return this._convertToEasyPostObject(c.body,a)}catch(c){return Promise.reject(c)}}static async removeShipments(t,e){const s=`batches/${t}/remove_shipments`,a={shipments:e.map(c=>({id:c}))};try{const c=await r._post(s,a);return this._convertToEasyPostObject(c.body,a)}catch(c){return Promise.reject(c)}}static async generateLabel(t,e=Lt){const s=`batches/${t}/label`,a={file_format:e};try{const c=await r._post(s,a);return this._convertToEasyPostObject(c.body,a)}catch(c){return Promise.reject(c)}}static async createScanForm(t){const e=`batches/${t}/scan_form`;try{const s=await r._post(e);return this._convertToEasyPostObject(s.body)}catch(s){return Promise.reject(s)}}static async buy(t){const e=`batches/${t}/buy`;try{const s=await r._post(e);return this._convertToEasyPostObject(s.body)}catch(s){return Promise.reject(s)}}static async all(t={}){return this._all("batches",t)}static async retrieve(t){const e=`batches/${t}`;return this._retrieve(e)}},Bt=r=>class extends l(r){static async retrieveStatelessRates(t){const e="beta/rates",s={shipment:t};try{const a=await r._post(e,s);return this._convertToEasyPostObject(a.body.rates,s)}catch(a){return Promise.reject(a)}}},Ft=r=>class extends l(r){static async addPaymentMethod(t,e,s="primary"){const a={payment_method:{stripe_customer_id:t,payment_method_reference:e,priority:s}};return await r._post("beta/referral_customers/payment_method",a)}static async refundByAmount(t){const e={refund_amount:t};return await r._post("beta/referral_customers/refunds",e)}static async refundByPaymentLog(t){const e={payment_log_id:t};return await r._post("beta/referral_customers/refunds",e)}};class T extends f{}const Ct=r=>class extends l(r){static async fundWallet(t,e="primary"){const s=await this._getPaymentInfo(e.toLowerCase()),a=s[0],c=s[1],i=`${a}/${c}/charges`,o={amount:t};await r._post(i,o)}static async deletePaymentMethod(t){const e=await this._getPaymentInfo(t.toLowerCase()),s=e[0],a=e[1],c=`${s}/${a}`;await r._delete(c)}static async retrievePaymentMethods(){const e=await r._get("payment_methods");if(e.body.id===null)throw new T({message:h.NO_PAYMENT_METHODS});return e.body}static async _getPaymentInfo(t){const e=await this.retrievePaymentMethods(),a={primary:"primary_payment_method",secondary:"secondary_payment_method"}[t];let c,i,o;const p="The chosen payment method is not valid. Please try again.";if(a!==void 0&&e[a]!==null)if(c=e[a].id,i=e[a].object,i==="CreditCard")o="credit_cards";else if(i==="BankAccount")o="bank_accounts";else throw new T({message:p});else throw new T({message:p});return[o,c]}},Vt=r=>class extends l(r){static async create(t){const e=t.type;if(!e)throw new k({message:b.format(h.MISSING_REQUIRED_PARAMETER,"CarrierAccount type")});const s=this._selectCarrierAccountCreationEndpoint(e),a=this._wrapCarrierAccountParams(e,t);return this._create(s,a)}static async update(t,e){const a=(await this.retrieve(t)).type,c=this._selectCarrierAccountUpdateEndpoint(a,t),i=this._wrapCarrierAccountParams(a,e);try{const o=await r._patch(c,i);return this._convertToEasyPostObject(o.body,i)}catch(o){return Promise.reject(o)}}static async delete(t){const e=`carrier_accounts/${t}`;try{return await r._delete(e),Promise.resolve()}catch(s){return Promise.reject(s)}}static _selectCarrierAccountCreationEndpoint(t){return h.CARRIER_ACCOUNTS_WITH_CUSTOM_CREATE_WORKFLOWS.includes(t)?"carrier_accounts/register":h.UPS_OAUTH_CARRIER_TYPES.includes(t)?"ups_oauth_registrations":"carrier_accounts"}static _selectCarrierAccountUpdateEndpoint(t,e){return h.UPS_OAUTH_CARRIER_TYPES.includes(t)?`ups_oauth_registrations/${e}`:`carrier_accounts/${e}`}static _wrapCarrierAccountParams(t,e){return h.UPS_OAUTH_CARRIER_TYPES.includes(t)?{ups_oauth_registrations:e}:{carrier_account:e}}static async all(t={}){return this._all("carrier_accounts",t)}static async retrieve(t){const e=`carrier_accounts/${t}`;return this._retrieve(e)}},Kt=r=>class extends l(r){static async retrieve(t=null,e=null){const s="metadata/carriers",a={...t&&t.length>0&&{carriers:t.join(",")},...e&&e.length>0&&{types:e.join(",")}};try{const c=await r._get(s,a);return this._convertToEasyPostObject(c.body.carriers||[],a)}catch(c){return Promise.reject(c)}}},Wt=r=>class extends l(r){static async all(t={}){const e="carrier_types";try{const s=await r._get(e,t);return this._convertToEasyPostObject(s.body,t)}catch(s){return Promise.reject(s)}}},zt=r=>class extends l(r){static async create(t){return this._create("claims",t)}static async all(t={}){return this._all("claims",t)}static async getNextPage(t,e=null){return this._getNextPage("claims","claims",t,e)}static async retrieve(t){const e=`claims/${t}`;return this._retrieve(e)}static async cancel(t){const e=`claims/${t}/cancel`;return this._create(e)}},Gt=r=>class extends l(r){static async create(t){const e="customs_infos",s={customs_info:t};return this._create(e,s)}static async retrieve(t){const e=`customs_infos/${t}`;return this._retrieve(e)}},Jt=r=>class extends l(r){static async create(t){const e="customs_items",s={customs_item:t};return this._create(e,s)}static async retrieve(t){const e=`customs_items/${t}`;return this._retrieve(e)}},Yt=r=>class extends l(r){static async create(t){const e="end_shippers",s={address:t};return this._create(e,s)}static async update(t,e){const s=`end_shippers/${t}`,a={address:e};try{const c=await r._put(s,a);return this._convertToEasyPostObject(c.body,a)}catch(c){return Promise.reject(c)}}static async retrieve(t){const e=`end_shippers/${t}`;return this._retrieve(e)}static async all(t={}){return this._all("end_shippers",t)}},Xt=r=>class extends l(r){static async retrieveAllPayloads(t){const e=`events/${t}/payloads`;try{const s=await r._get(e);return this._convertToEasyPostObject(s.body.payloads)}catch(s){return Promise.reject(s)}}static async retrievePayload(t,e){const s=`events/${t}/payloads/${e}`;try{const a=await r._get(s);return this._convertToEasyPostObject(a.body)}catch(a){return Promise.reject(a)}}static async all(t={}){return this._all("events",t)}static async getNextPage(t,e=null){return this._getNextPage("events","events",t,e)}static async retrieve(t){const e=`events/${t}`;return this._retrieve(e)}},Qt=r=>class extends l(r){static async create(t){const e="insurances",s={insurance:t};return this._create(e,s)}static async all(t={}){return this._all("insurances",t)}static async getNextPage(t,e=null){return this._getNextPage("insurances","insurances",t,e)}static async retrieve(t){const e=`insurances/${t}`;return this._retrieve(e)}static async refund(t){const e=`insurances/${t}/refund`,s=await r._post(e);return this._convertToEasyPostObject(s.body)}},Zt=r=>class extends l(r){static async create(t){const e="orders",s={order:t};return this._create(e,s)}static async buy(t,e,s){const a=`orders/${t}/buy`,c={carrier:e,service:s};try{const i=await r._post(a,c);return this._convertToEasyPostObject(i.body,c)}catch(i){return Promise.reject(i)}}static async getRates(t){const e=`orders/${t}/rates`;try{const s=await r._get(e);return this._convertToEasyPostObject(s.body)}catch(s){return Promise.reject(s)}}static async retrieve(t){const e=`orders/${t}`;return this._retrieve(e)}},te=r=>class extends l(r){static async create(t){const e="parcels",s={parcel:t};return this._create(e,s)}static async retrieve(t){const e=`parcels/${t}`;return this._retrieve(e)}},ee=r=>class extends l(r){static async create(t){const e="pickups",s={pickup:t};return this._create(e,s)}static async buy(t,e,s){const a=`pickups/${t}/buy`,c={carrier:e,service:s};try{const i=await r._post(a,c);return this._convertToEasyPostObject(i.body,c)}catch(i){return Promise.reject(i)}}static async cancel(t){const e=`pickups/${t}/cancel`;try{const s=await r._post(e);return this._convertToEasyPostObject(s.body)}catch(s){return Promise.reject(s)}}static async all(t={}){return this._all("pickups",t)}static async getNextPage(t,e=null){return this._getNextPage("pickups","pickups",t,e)}static async retrieve(t){const e=`pickups/${t}`;return this._retrieve(e)}},se=r=>class extends l(r){static async retrieve(t){const e=`rates/${t}`;return this._retrieve(e)}};class re extends m{}function ae(r,n){return d.copyClient(r,{apiKey:n})}async function ce(r){return(await r._get("partners/stripe_public_key")).body.public_key}async function ne(r,n,t,e,s){const a=`https://api.stripe.com/v1/tokens?card[number]=${n}&card[exp_month]=${t}&card[exp_year]=${e}&card[cvc]=${s}`,c=R.post(a).set({Authorization:`Bearer ${r}`,"Content-Type":"application/x-www-form-urlencoded"});try{return(await c).body.id}catch{throw new re({message:b.format(h.EXTERNAL_API_CALL_FAILED,"Stripe")})}}async function ie(r,n,t,e){const s=ae(r,n),a="credit_cards",c={credit_card:{stripe_object_id:t,priority:e}};return(await s._post(a,c)).body}const oe=r=>class extends l(r){static async create(t){const e="referral_customers",s={user:t};return this._create(e,s)}static async updateEmail(t,e){const s=`referral_customers/${t}`,a={user:{email:e}};return await r._put(s,a),!0}static async addCreditCard(t,e,s,a,c,i="primary"){const o=await ce(r),p=await ne(o,e,s,a,c);return await ie(r,t,p,i)}static async all(t={}){return this._all("referral_customers",t)}static async getNextPage(t,e=null){return this._getNextPage("referral_customers","referral_customers",t,e)}},ue=r=>class extends l(r){static async create(t){const e="refunds",s={refund:t};return this._create(e,s)}static async all(t={}){return this._all("refunds",t)}static async getNextPage(t,e=null){return this._getNextPage("refunds","refunds",t,e)}static async retrieve(t){const e=`refunds/${t}`;return this._retrieve(e)}},le=r=>class extends l(r){static async create(t){const e=`reports/${t.type}`;return this._create(e,t)}static async all(t={}){const e=t.type,s=`reports/${e}`;delete t.type;try{const a=await r._get(s,t);return this._convertToEasyPostObject(a.body,{...t,type:e})}catch(a){return Promise.reject(a)}}static async getNextPage(t,e=null){const s=`reports/${t.reports[0]._params.type}`;return this._getNextPage(s,"reports",t,e)}static async retrieve(t){const e=`reports/${t}`;return this._retrieve(e)}},de=r=>class extends l(r){static async create(t){const e="scan_forms";t.shipments&&(t.shipments=t.shipments.map(a=>typeof a=="string"?{id:a}:{id:a.id}));const s={scan_form:t};return this._create(e,s)}static async all(t={}){return this._all("scan_forms",t)}static async getNextPage(t,e=null){return this._getNextPage("scan_forms","scan_forms",t,e)}static async retrieve(t){const e=`scan_forms/${t}`;return this._retrieve(e)}},_e=r=>class extends l(r){static async create(t){const e="shipments",s={shipment:t};return this._create(e,s)}static async buy(t,e,s=null,a=null){let c=e;typeof e=="object"&&(c=e.id);const i=`shipments/${t}/buy`,o={rate:{id:c}};s&&(o.insurance=s),a&&(o.end_shipper_id=a);try{const p=await r._post(i,o);return this._convertToEasyPostObject(p.body,o)}catch(p){return Promise.reject(p)}}static async convertLabelFormat(t,e){const s=`shipments/${t}/label`,a={file_format:e};try{const c=await r._get(s,a);return this._convertToEasyPostObject(c.body,a)}catch(c){return Promise.reject(c)}}static async regenerateRates(t){const e=`shipments/${t}/rerate`,s={};try{const a=await r._post(e,s);return this._convertToEasyPostObject(a.body,s)}catch(a){return Promise.reject(a)}}static async getSmartRates(t){const e=`shipments/${t}/smartrate`;try{const s=await r._get(e);return this._convertToEasyPostObject(s.body.result)}catch(s){return Promise.reject(s)}}static async insure(t,e){const s=`shipments/${t}/insure`,a={amount:e};try{const c=await r._post(s,a);return this._convertToEasyPostObject(c.body,a)}catch(c){return Promise.reject(c)}}static async generateForm(t,e,s={}){const a=`shipments/${t}/forms`,c={form:{...s,type:e}};try{const i=await r._post(a,c);return this._convertToEasyPostObject(i.body,c)}catch(i){return Promise.reject(i)}}static async refund(t){const e=`shipments/${t}/refund`;try{const s=await r._post(e);return this._convertToEasyPostObject(s.body)}catch(s){return Promise.reject(s)}}static async lowestSmartRate(t,e,s){const a=await this.getSmartRates(t);return h.Utils.getLowestSmartRate(a,e,s.toLowerCase())}static async all(t={}){return this._all("shipments",t)}static async getNextPage(t,e=null){return this._getNextPage("shipments","shipments",t,e)}static async retrieve(t){const e=`shipments/${t}`;return this._retrieve(e)}static async retrieveEstimatedDeliveryDate(t,e){var c;const s=`shipments/${t}/smartrate/delivery_date`,a={planned_ship_date:e};try{const i=await r._get(s,a);return this._convertToEasyPostObject((c=i.body.rates)!=null?c:[],a)}catch(i){return Promise.reject(i)}}static async recommendShipDate(t,e){var c;const s=`shipments/${t}/smartrate/precision_shipping`,a={desired_delivery_date:e};try{const i=await r._get(s,a);return this._convertToEasyPostObject((c=i.body.rates)!=null?c:[],a)}catch(i){return Promise.reject(i)}}},pe=r=>class extends l(r){static async estimateDeliveryDate(t){const e="smartrate/deliver_by";try{const s=await r._post(e,t);return this._convertToEasyPostObject(s.body,t)}catch(s){return Promise.reject(s)}}static async recommendShipDate(t){const e="smartrate/deliver_on";try{const s=await r._post(e,t);return this._convertToEasyPostObject(s.body,t)}catch(s){return Promise.reject(s)}}},he=r=>class extends l(r){static async create(t){const e="trackers",s={tracker:t};return this._create(e,s)}static async all(t={}){return this._all("trackers",t)}static async getNextPage(t,e=null){return this._getNextPage("trackers","trackers",t,e)}static async retrieve(t){const e=`trackers/${t}`;return this._retrieve(e)}},me=r=>class extends l(r){static async create(t){const e="users",s={user:t};return this._create(e,s)}static async update(t,e){const s=`users/${t}`,a={user:e};try{const c=await r._patch(s,a);return this._convertToEasyPostObject(c.body,a)}catch(c){return Promise.reject(c)}}static async retrieve(t){const e=`users/${t}`;try{const s=await r._get(e);return this._convertToEasyPostObject(s.body)}catch(s){return Promise.reject(s)}}static async retrieveMe(){const t="users";try{const e=await r._get(t);return this._convertToEasyPostObject(e.body)}catch(e){return Promise.reject(e)}}static async delete(t){const e=`users/${t}`;try{return await r._delete(e),Promise.resolve()}catch(s){return Promise.reject(s)}}static async updateBrand(t,e){const s=`users/${t}/brand`,a={brand:e};try{const c=await r._patch(s,a);return this._convertToEasyPostObject(c.body,a)}catch(c){return Promise.reject(c)}}static async allChildren(t){const e="users/children";try{const s=await r._get(e,t);return this._convertToEasyPostObject(s.body,t)}catch(s){return Promise.reject(s)}}static async getNextPage(t,e=null){return this._getNextPage("users/children","children",t,e)}static async _getNextPage(t,e,s,a=null){var _,y,v;const c=s[e];if(c==null||c.length==0||!s.has_more)throw new P;const i=(y=(_=s._params)!=null?_:c[0]._params)!=null?y:{},o={...i,page_size:(v=i.page_size)!=null?v:a,after_id:c[c.length-1].id},p=await this._all(t,o);if(p==null||p[e].length==0)throw new P;return p}},ye=r=>class extends l(r){static async create(t){const e="webhooks",s={webhook:t};return this._create(e,s)}static async update(t,e){const s=`webhooks/${t}`;try{const a=await r._patch(s,e);return this._convertToEasyPostObject(a.body,e)}catch(a){return Promise.reject(a)}}static async delete(t){const e=`webhooks/${t}`;try{return await r._delete(e),Promise.resolve()}catch(s){return Promise.reject(s)}}static async all(t={}){return this._all("webhooks",t)}static async retrieve(t){const e=`webhooks/${t}`;return this._retrieve(e)}};class d{constructor(n,t={}){const{useProxy:e,timeout:s,baseUrl:a,superagentMiddleware:c,requestMiddleware:i}=t;if(!n&&!e)throw new Nt({message:b.format(h.MISSING_REQUIRED_PARAMETER,"API Key")});this.key=n,this.timeout=s||d.DEFAULT_TIMEOUT,this.baseUrl=a||d.DEFAULT_BASE_URL,this.agent=R,this.requestMiddleware=i,this.requestHooks=[],this.responseHooks=[],this.Utils=new I,c&&(this.agent=c(this.agent)),this._attachServices(d.SERVICES)}addRequestHook(n){this.requestHooks=[...this.requestHooks,n]}removeRequestHook(n){this.requestHooks=this.requestHooks.filter(t=>t!==n)}clearRequestHooks(){this.requestHooks=[]}addResponseHook(n){this.responseHooks=[...this.responseHooks,n]}removeResponseHook(n){this.responseHooks=this.responseHooks.filter(t=>t!==n)}clearResponseHooks(){this.responseHooks=[]}static copyClient(n,t={}){const{apiKey:e,useProxy:s,timeout:a,baseUrl:c,superagentMiddleware:i,requestMiddleware:o}=t,p=i?i(n.agent):n.agent;return new d(e||n.key,{useProxy:s||n.useProxy,timeout:a||n.timeout,baseUrl:c||n.baseUrl,agent:p,requestMiddleware:o||n.requestMiddleware})}static _buildHeaders(n={}){return{...d.DEFAULT_HEADERS,...n}}_attachServices(n){Object.keys(n).forEach(t=>{this[t]=n[t](this)})}_buildPath(n=""){if(n.indexOf("http")===0)return n;let t=this.baseUrl+n;return t=n.includes("beta")?t.replace("/v2",""):t,t}_createResponseHooksValue(n,t){return{...n,httpStatus:t.status,responseBody:t.body,headers:t.headers,responseTimestamp:Date.now()}}async _request(n="",t=d.METHODS.GET,e={},s={}){const a=this._buildPath(n),c=d._buildHeaders(s);let i=this.agent[t](a).set(c);this.requestMiddleware&&(i=this.requestMiddleware(i)),this.key&&i.auth(this.key);const o=new URL(a);e!==void 0&&(t===d.METHODS.GET||t===d.METHODS.DELETE?(i.query(e),Object.entries(e).forEach(([_,y])=>{o.searchParams.append(_,y)})):i.send(e));const p={method:t,path:o.toString(),requestBody:i._data,headers:c,requestTimestamp:Date.now(),requestUUID:st.v4()};this.requestHooks.forEach(_=>_(p));try{const _=await i;if(this.responseHooks.length>0){const y=this._createResponseHooksValue(p,_);this.responseHooks.forEach(v=>v(y))}return _}catch(_){if(_.response&&_.response.body){const y=this._createResponseHooksValue(p,_.response);throw this.responseHooks.forEach(v=>v(y)),It.handleApiError(_.response)}else throw _}}_get(n,t={},e={}){return this._request(n,d.METHODS.GET,t,e)}_post(n,t={},e={}){return this._request(n,d.METHODS.POST,t,e)}_put(n,t={},e={}){return this._request(n,d.METHODS.PUT,t,e)}_patch(n,t={},e={}){return this._request(n,d.METHODS.PATCH,t,e)}_delete(n,t={},e={}){return this._request(n,d.METHODS.DELETE,t,e)}}d.MS_SECOND=1e3;d.DEFAULT_TIMEOUT=60*d.MS_SECOND;d.DEFAULT_BASE_URL="https://api.easypost.com/v2/";d.DEFAULT_HEADERS={Accept:"application/json","Content-Type":"application/json","User-Agent":`EasyPost/v2 NodejsClient/${vt.version} Nodejs/${process.versions.node} OS/${w.platform()} OSVersion/${w.release()} OSArch/${w.arch()}`};d.METHODS={GET:"get",POST:"post",PUT:"put",PATCH:"patch",DELETE:"del"};d.SERVICES={Address:Ht,ApiKey:Mt,Batch:qt,BetaRate:Bt,BetaReferralCustomer:Ft,Billing:Ct,CarrierAccount:Vt,CarrierMetadata:Kt,CarrierType:Wt,Claim:zt,CustomsInfo:Gt,CustomsItem:Jt,EndShipper:Yt,Event:Xt,Insurance:Qt,Order:Zt,Parcel:te,Pickup:ee,Rate:se,ReferralCustomer:oe,Refund:ue,Report:le,ScanForm:de,Shipment:_e,SmartRate:pe,Tracker:he,User:me,Webhook:ye};module.exports=d;
